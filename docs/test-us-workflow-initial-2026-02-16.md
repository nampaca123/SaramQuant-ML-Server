# US 워크플로우 테스트 결과 (2026-02-16)

## 실행 환경

| 항목 | 값 |
|---|---|
| OS | Windows 10 (10.0.26200) |
| Python | 3.14.3 |
| DB | Supabase PostgreSQL (Transaction Pooler) |
| 실행 방식 | `python -m app.pipeline us` + `python -m app.pipeline us-fs` |
| 재무제표 서버 | Railway NestJS (US East, `saramquant-usa-fstatements-collector`) |

## 단계별 소요시간

### `python -m app.pipeline us` — 총 4분 19초

| 단계 | 시작 | 종료 | 소요 | 비고 |
|---|---|---|---|---|
| 종목 목록 수집 | 13:01:48 | 13:01:50 | **2초** | NYSE 2,041 + NASDAQ 3,861 = 5,902종목 |
| 섹터 수집 (Nasdaq Screener) | 13:01:50 | 13:01:55 | **5초** | NYSE 2,287 + NASDAQ 3,783 매핑, 90건 업데이트 |
| 일봉 수집 (Alpaca) | 13:01:55 | 13:04:41 | **2분 46초** | 119배치 x 50종목, 5,902종목 1년치 |
| 벤치마크 수집 (yfinance) | 13:04:41 | 13:04:45 | **4초** | S&P500 + NASDAQ 지수 |
| 무위험이자율 (FRED) | 13:04:45 | 13:04:52 | **7초** | 91D, 1Y, 3Y, 10Y |
| 지표 계산 | 13:04:52 | 13:06:05 | **1분 13초** | NYSE 2,018 + NASDAQ 3,722 = 5,740종목 |
| 펀더멘털 계산 | 13:06:05 | 13:06:05 | **< 1초** | 재무제표 미수집 상태이므로 0건 |

### `python -m app.pipeline us-fs` — 총 1분 58초

| 단계 | 시작 | 종료 | 소요 | 비고 |
|---|---|---|---|---|
| Railway 서버 요청 및 폴링 | 13:07:46 | 13:09:21 | **1분 35초** | 5,902종목 파싱, 45,976건 수집, 실패 0 |
| 펀더멘털 계산 | 13:09:21 | 13:09:42 | **21초** | NYSE 1,601 + NASDAQ 3,003 = 4,604종목 |

## 데이터 수집 현황

### US 단독

| 테이블 | US 건수 |
|---|---|
| stocks | 5,902 |
| daily_prices | 1,393,715 (전체 2,007,304 - KR 613,589) |
| stock_indicators | 5,740 (전체 8,272 - KR 2,532) |
| financial_statements | 45,976 (전체 63,130 - KR 17,154) |
| stock_fundamentals | 4,604 (전체 7,078 - KR 2,474) |
| benchmark_daily_prices | 3,076 (S&P500 1,538 + NASDAQ 1,538) |
| risk_free_rates | 26,124 (91D + 1Y + 3Y + 10Y 각 6,531) |

### KR + US 합산

| 테이블 | 합산 건수 |
|---|---|
| stocks | 8,509 |
| daily_prices | 2,007,304 |
| stock_indicators | 8,272 |
| financial_statements | 63,130 |
| stock_fundamentals | 7,078 |
| benchmark_daily_prices | 6,084 |
| risk_free_rates | 45,244 |

## 데이터 품질 검증

### 필터링

| 항목 | 결과 | 판정 |
|---|---|---|
| 심볼 유효성 (5자 이하 알파벳) | 위반 0건 | PASS |
| 가격 이상값 (close <= 0) | 6건 (워런트/초소형주 소수점 절사) | OK |
| high < low | 0건 | PASS |

가격 이상 6건 상세:
- BENFW (워런트, 3건) — 0.01 → 0.00 절사
- MLECW (워런트, 1건) — 0.01 → 0.00 절사
- PLRZ (초소형주, 2건) — 가격 $0.01 미만

### 커버리지

| 마켓 | 활성 종목 | 일봉 보유 | 지표 계산 | 펀더멘털 계산 |
|---|---|---|---|---|
| US_NYSE | 2,041 | 2,041 (100.0%) | 2,018 (98.9%) | 1,601 (78.4%) |
| US_NASDAQ | 3,861 | 3,857 (99.9%) | 3,722 (96.4%) | 3,003 (77.8%) |

- 지표 미계산 (2041 - 2018 = 23, 3861 - 3722 = 139): 일봉 60일 미만 종목 (신규 상장/IPO)
- 펀더멘털 미산출 (~22%): SEC EDGAR에 재무제표 미등록 기업 (소형주, SPAC 잔여, 외국기업 등)

### 섹터 커버리지

| 마켓 | 섹터 있음 | 섹터 없음 |
|---|---|---|
| US_NYSE | 1,974 (96.7%) | 67 (3.3%) |
| US_NASDAQ | 3,516 (91.1%) | 345 (8.9%) |

### 펀더멘털 항목별 채움률 (US 4,604건 기준)

| 항목 | 건수 | 비율 |
|---|---|---|
| PER | 1,280 | 27.8% |
| PBR | 3,336 | 72.5% |
| EPS | 1,280 | 27.8% |
| ROE | 1,481 | 32.2% |
| 부채비율 | 3,925 | 85.3% |

- PER/EPS 비율이 낮은 이유: 미국 기업 다수가 적자(EPS <= 0)이거나 순이익 미보고
- PBR/부채비율은 대차대조표 기반이라 상대적으로 높은 채움률

### 기간

| 데이터 | 시작일 | 종료일 | 거래일 수 |
|---|---|---|---|
| US 일봉 | 2025-02-18 | 2026-02-13 | 250일 |
| 벤치마크 (S&P500/NASDAQ) | 2020-01-02 | 2026-02-13 | 1,538일 |
| 무위험이자율 (91D/1Y/3Y/10Y) | 2000-01-03 | 2026-02-12 | 6,531일 |

## 발견 사항

### Nasdaq Screener User-Agent

`Mozilla/5.0 (compatible; SaramQuant/1.0)` 헤더로 Windows 환경에서도 정상 작동 확인. NYSE 2,287 + NASDAQ 3,783 섹터 매핑 성공.

### numpy RuntimeWarning

지표 계산 중 일부 종목에서 `invalid value encountered in subtract/dot` 경고 발생. 거래가 극히 드문 종목(분산 0)에서 공분산 계산 시 NaN이 발생하는 것으로, `_safe_last`에서 `pd.isna` 체크로 None 처리되므로 기능상 문제 없음.

### Railway NestJS 서버

US East 서버에서 5,902종목 재무제표 수집 약 1분 35초 소요. 45,976건 수집, 실패 0건. 안정적으로 동작.
