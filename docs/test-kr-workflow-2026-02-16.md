# KR 워크플로우 초기실행 테스트 결과 (2026-02-16)

## 실행 환경

| 항목 | 값 |
|---|---|
| OS | Windows 10 (10.0.26200) |
| Python | 3.14.3 |
| DB | Supabase PostgreSQL (Transaction Pooler) |
| 실행 방식 | `python -m app.pipeline kr` + `python -m app.pipeline kr-fs` |

## 단계별 소요시간

### `python -m app.pipeline kr` — 총 12분 8초

| 단계 | 시작 | 종료 | 소요 | 비고 |
|---|---|---|---|---|
| 종목 목록 수집 | 12:36:38 | 12:36:39 | **1초** | KOSPI 896 + KOSDAQ 1,711 = 2,607종목 |
| 섹터 수집 | 12:36:39 | 12:37:42 | **1분 3초** | 89건 업데이트 (pykrx) |
| 일봉 수집 (KOSPI) | 12:37:42 | 12:41:13 | **3분 31초** | 366일분 |
| 일봉 수집 (KOSDAQ) | 12:41:13 | 12:46:10 | **4분 57초** | 366일분 |
| 벤치마크 수집 | 12:46:10 | 12:46:21 | **11초** | KOSPI + KOSDAQ 지수 |
| 무위험이자율 수집 | 12:46:21 | 12:48:19 | **1분 58초** | 91D, 3Y, 10Y (ECOS API) |
| 지표 계산 | 12:48:19 | 12:48:44 | **25초** | 2,532종목 계산 |
| 펀더멘털 계산 | 12:48:44 | 12:48:44 | **< 1초** | 재무제표 미수집 상태이므로 0건 |

### `python -m app.pipeline kr-fs` — 총 34초

| 단계 | 시작 | 종료 | 소요 | 비고 |
|---|---|---|---|---|
| DART corp_code 동기화 | 12:50:54 | 12:51:13 | **19초** | 2,517종목 매핑 |
| 재무제표 수집 (DART API) | 12:51:14 | 12:51:25 | **11초** | 208 API 호출, 17,154건 |
| 펀더멘털 계산 | 12:51:25 | 12:51:27 | **2초** | 2,474종목 |

## 데이터 수집 현황

| 테이블 | 건수 |
|---|---|
| stocks | 2,607 |
| daily_prices | 613,589 |
| stock_indicators | 2,532 |
| financial_statements | 17,154 |
| stock_fundamentals | 2,474 |
| benchmark_daily_prices | 3,008 |
| risk_free_rates | 19,120 |

## 데이터 품질 검증

### 필터링

| 항목 | 결과 | 판정 |
|---|---|---|
| 스팩 종목 포함 여부 | 0건 | PASS |
| ETF/리츠/인버스/레버리지 | 0건 (2건 오탐: 메리츠금융지주, 블리츠웨이엔터테인먼트) | PASS |
| 이상 가격 (close <= 0 또는 high < low) | 0건 | PASS |

### 커버리지

| 마켓 | 활성 종목 | 일봉 보유 | 지표 계산 | 펀더멘털 계산 |
|---|---|---|---|---|
| KR_KOSPI | 896 | 889 (99.2%) | 879 (98.1%) | 801 (89.4%) |
| KR_KOSDAQ | 1,711 | 1,679 (98.1%) | 1,653 (96.6%) | 1,673 (97.8%) |

- 일봉 미보유 39종목: 거래정지/상폐 직전 종목으로 추정
- 지표 미계산 (889 - 879 = 10, 1679 - 1653 = 26): 일봉 60일 미만 종목 (신규 상장 등)

### 펀더멘털 항목별 채움률 (2,474건 기준)

| 항목 | 건수 | 비율 |
|---|---|---|
| PER | 2,224 | 89.9% |
| PBR | 2,464 | 99.6% |
| EPS | 2,224 | 89.9% |
| ROE | 2,225 | 90.0% |
| 부채비율 | 2,474 | 100.0% |

- PER/EPS 미산출 250건: 적자 기업(EPS <= 0)으로 PER 산출 불가

### 기간

| 데이터 | 시작일 | 종료일 | 거래일 수 |
|---|---|---|---|
| 일봉 | 2025-02-17 | 2026-02-13 | 245일 |
| 벤치마크 (KOSPI/KOSDAQ) | 2020-01-02 | 2026-02-13 | 1,504일 |
| 무위험이자율 (91D) | 2000-01-04 | 2026-02-13 | 6,519일 |
| 무위험이자율 (3Y) | 2000-01-04 | 2026-02-13 | 6,468일 |
| 무위험이자율 (10Y) | 2000-12-18 | 2026-02-13 | 6,133일 |

## 발견 사항

### 수정한 버그

`indicator_service.py`의 `_compute_risk`에서 `beta()`, `alpha()`, `sharpe_ratio()` 반환값(numpy 스칼라)을 `float()`로 감싸지 않아, numpy 2.x 환경에서 `np.float64(...)` 리터럴이 SQL에 삽입되는 오류가 있었음. `float()` 명시적 변환으로 해결.

### 로그 표시 오차

`IndicatorRepository.insert_batch()`가 `execute_values` 후 `cur.rowcount`를 반환하는데, `execute_values`는 내부적으로 페이지 단위로 실행하므로 마지막 페이지의 rowcount만 반환됨. 로그에 "Inserted 32 indicator rows"로 표시되지만 실제로는 2,532건 삽입됨.

### pykrx FutureWarning

`pykrx` 내부에서 `df.replace("", 0)` 사용 시 pandas의 downcasting 관련 FutureWarning 발생. 라이브러리 내부 문제로, 기능에는 영향 없음.
